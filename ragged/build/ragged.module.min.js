var Ln=Object.defineProperty;var Un=(r,t)=>{for(var e in t)Ln(r,e,{get:t[e],enumerable:!0})};var gt="4.30.0";var Jr=!1,yt,sr,Nn,qn,Hn,or,Xn,Ce,ir,ar,cr,Ee,lr;function Vr(r,t={auto:!1}){if(Jr)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(yt)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${yt}'\``);Jr=t.auto,yt=r.kind,sr=r.fetch,Nn=r.Request,qn=r.Response,Hn=r.Headers,or=r.FormData,Xn=r.Blob,Ce=r.File,ir=r.ReadableStream,ar=r.getMultipartRequestOptions,cr=r.getDefaultAgent,Ee=r.fileFromPath,lr=r.isFsReadStream}var ve=class{constructor(t){this.body=t}get[Symbol.toStringTag](){return"MultipartBody"}};function Gr({manuallyImported:r}={}){let t=r?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",e,n,s,o;try{e=fetch,n=Request,s=Response,o=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${t}`)}return{kind:"web",fetch:e,Request:n,Response:s,Headers:o,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(i,a)=>({...a,body:new ve(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}yt||Vr(Gr(),{auto:!0});var ur={};Un(ur,{APIConnectionError:()=>G,APIConnectionTimeoutError:()=>K,APIError:()=>A,APIUserAbortError:()=>w,AuthenticationError:()=>qt,BadRequestError:()=>Nt,ConflictError:()=>Jt,InternalServerError:()=>Kt,NotFoundError:()=>Xt,OpenAIError:()=>p,PermissionDeniedError:()=>Ht,RateLimitError:()=>Gt,UnprocessableEntityError:()=>Vt});var p=class extends Error{},A=class r extends p{constructor(t,e,n,s){super(`${r.makeMessage(t,e,n)}`),this.status=t,this.headers=s;let o=e;this.error=o,this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(t,e,n){let s=e?.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):n;return t&&s?`${t} ${s}`:t?`${t} status code (no body)`:s||"(no status code or body)"}static generate(t,e,n,s){if(!t)return new G({cause:Re(e)});let o=e?.error;return t===400?new Nt(t,o,n,s):t===401?new qt(t,o,n,s):t===403?new Ht(t,o,n,s):t===404?new Xt(t,o,n,s):t===409?new Jt(t,o,n,s):t===422?new Vt(t,o,n,s):t===429?new Gt(t,o,n,s):t>=500?new Kt(t,o,n,s):new r(t,o,n,s)}},w=class extends A{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0),this.status=void 0}},G=class extends A{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),this.status=void 0,e&&(this.cause=e)}},K=class extends G{constructor({message:t}={}){super({message:t??"Request timed out."})}},Nt=class extends A{constructor(){super(...arguments),this.status=400}},qt=class extends A{constructor(){super(...arguments),this.status=401}},Ht=class extends A{constructor(){super(...arguments),this.status=403}},Xt=class extends A{constructor(){super(...arguments),this.status=404}},Jt=class extends A{constructor(){super(...arguments),this.status=409}},Vt=class extends A{constructor(){super(...arguments),this.status=422}},Gt=class extends A{constructor(){super(...arguments),this.status=429}},Kt=class extends A{};var q=class r{constructor(t,e){this.iterator=t,this.controller=e}static fromSSEResponse(t,e){let n=!1,s=new fr;async function*o(){if(!t.body)throw e.abort(),new p("Attempted to iterate over a response with no body");let a=new zt,c=Kr(t.body);for await(let f of c)for(let g of a.decode(f)){let b=s.decode(g);b&&(yield b)}for(let f of a.flush()){let g=s.decode(f);g&&(yield g)}}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let c of o())if(!a){if(c.data.startsWith("[DONE]")){a=!0;continue}if(c.event===null){let f;try{f=JSON.parse(c.data)}catch(g){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),g}if(f&&f.error)throw new A(void 0,f.error,void 0,void 0);yield f}else{let f;try{f=JSON.parse(c.data)}catch(g){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),g}if(c.event=="error")throw new A(void 0,f.error,f.message,void 0);yield{event:c.event,data:f}}}a=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{a||e.abort()}}return new r(i,e)}static fromReadableStream(t,e){let n=!1;async function*s(){let i=new zt,a=Kr(t);for await(let c of a)for(let f of i.decode(c))yield f;for(let c of i.flush())yield c}async function*o(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(let a of s())i||a&&(yield JSON.parse(a));i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||e.abort()}}return new r(o,e)}[Symbol.asyncIterator](){return this.iterator()}tee(){let t=[],e=[],n=this.iterator(),s=o=>({next:()=>{if(o.length===0){let i=n.next();t.push(i),e.push(i)}return o.shift()}});return[new r(()=>s(t),this.controller),new r(()=>s(e),this.controller)]}toReadableStream(){let t=this,e,n=new TextEncoder;return new ir({async start(){e=t[Symbol.asyncIterator]()},async pull(s){try{let{value:o,done:i}=await e.next();if(i)return s.close();let a=n.encode(JSON.stringify(o)+`
`);s.enqueue(a)}catch(o){s.error(o)}},async cancel(){await e.return?.()}})}},fr=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;let o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,n,s]=Vn(t,":");return s.startsWith(" ")&&(s=s.substring(1)),e==="event"?this.event=s:e==="data"&&this.data.push(s),null}},zt=class r{constructor(){this.buffer=[],this.trailingCR=!1}decode(t){let e=this.decodeText(t);if(this.trailingCR&&(e="\r"+e,this.trailingCR=!1),e.endsWith("\r")&&(this.trailingCR=!0,e=e.slice(0,-1)),!e)return[];let n=r.NEWLINE_CHARS.has(e[e.length-1]||""),s=e.split(r.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof Buffer<"u"){if(t instanceof Buffer)return t.toString();if(t instanceof Uint8Array)return Buffer.from(t).toString();throw new p(`Unexpected: received non-Uint8Array (${t.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(t instanceof Uint8Array||t instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(t);throw new p(`Unexpected: received non-Uint8Array/ArrayBuffer (${t.constructor.name}) in a web platform. Please report this error.`)}throw new p("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let t=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,t}};zt.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]);zt.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Vn(r,t){let e=r.indexOf(t);return e!==-1?[r.substring(0,e),t,r.substring(e+t.length)]:[r,"",""]}function Kr(r){if(r[Symbol.asyncIterator])return r;let t=r.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var zr=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Qr=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Yr(r),Yr=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Gn=r=>Qr(r)||zr(r)||lr(r);async function dr(r,t,e){if(r=await r,e??(e=Qr(r)?{lastModified:r.lastModified,type:r.type}:{}),zr(r)){let s=await r.blob();return t||(t=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new Ce([s],t,e)}let n=await Kn(r);if(t||(t=Qn(r)??"unknown_file"),!e.type){let s=n[0]?.type;typeof s=="string"&&(e={...e,type:s})}return new Ce(n,t,e)}async function Kn(r){let t=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)t.push(r);else if(Yr(r))t.push(await r.arrayBuffer());else if(Yn(r))for await(let e of r)t.push(e);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${r?.constructor?.name}; props: ${zn(r)}`);return t}function zn(r){return`[${Object.getOwnPropertyNames(r).map(e=>`"${e}"`).join(", ")}]`}function Qn(r){return hr(r.name)||hr(r.filename)||hr(r.path)?.split(/[\\/]/).pop()}var hr=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},Yn=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",mr=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody";var H=async r=>{let t=await Zr(r.body);return ar(t,r)},Zr=async r=>{let t=new or;return await Promise.all(Object.entries(r||{}).map(([e,n])=>pr(t,e,n))),t};var pr=async(r,t,e)=>{if(e!==void 0){if(e==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")r.append(t,String(e));else if(Gn(e)){let n=await dr(e);r.append(t,n)}else if(Array.isArray(e))await Promise.all(e.map(n=>pr(r,t+"[]",n)));else if(typeof e=="object")await Promise.all(Object.entries(e).map(([n,s])=>pr(r,`${t}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${e} instead`)}};var ts=function(r,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!s:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,e):s?s.value=e:t.set(r,e),e},es=function(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)},Ie;async function sn(r){let{response:t}=r;if(r.options.stream)return Qt("response",t.status,t.url,t.headers,t.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(t,r.controller):q.fromSSEResponse(t,r.controller);if(t.status===204)return null;if(r.options.__binaryResponse)return t;let e=t.headers.get("content-type");if(e?.includes("application/json")||e?.includes("application/vnd.api+json")){let o=await t.json();return Qt("response",t.status,t.url,t.headers,o),o}let s=await t.text();return Qt("response",t.status,t.url,t.headers,s),s}var Oe=class r extends Promise{constructor(t,e=sn){super(n=>{n(null)}),this.responsePromise=t,this.parseResponse=e}_thenUnwrap(t){return new r(this.responsePromise,async e=>t(await this.parseResponse(e)))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){let[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}},Fe=class{constructor({baseURL:t,maxRetries:e=2,timeout:n=6e5,httpAgent:s,fetch:o}){this.baseURL=t,this.maxRetries=gr("maxRetries",e),this.timeout=gr("timeout",n),this.httpAgent=s,this.fetch=o??sr}authHeaders(t){return{}}defaultHeaders(t){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...is(),...this.authHeaders(t)}}validateHeaders(t,e){}defaultIdempotencyKey(){return`stainless-node-retry-${us()}`}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,n){return this.request(Promise.resolve(n).then(s=>({method:t,path:e,...s})))}getAPIList(t,e,n){return this.requestAPIList(e,{method:"get",path:t,...n})}calculateContentLength(t){if(typeof t=="string"){if(typeof Buffer<"u")return Buffer.byteLength(t,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(t).length.toString()}return null}buildRequest(t){let{method:e,path:n,query:s,headers:o={}}=t,i=mr(t.body)?t.body.body:t.body?JSON.stringify(t.body,null,2):null,a=this.calculateContentLength(i),c=this.buildURL(n,s);"timeout"in t&&gr("timeout",t.timeout);let f=t.timeout??this.timeout,g=t.httpAgent??this.httpAgent??cr(c),b=f+1e3;typeof g?.options?.timeout=="number"&&b>(g.options.timeout??0)&&(g.options.timeout=b),this.idempotencyHeader&&e!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);let h=this.buildHeaders({options:t,headers:o,contentLength:a});return{req:{method:e,...i&&{body:i},headers:h,...g&&{agent:g},signal:t.signal??null},url:c,timeout:f}}buildHeaders({options:t,headers:e,contentLength:n}){let s={};n&&(s["content-length"]=n);let o=this.defaultHeaders(t);return nn(s,o),nn(s,e),mr(t.body)&&yt!=="node"&&delete s["content-type"],this.validateHeaders(s,e),s}async prepareOptions(t){}async prepareRequest(t,{url:e,options:n}){}parseHeaders(t){return t?Symbol.iterator in t?Object.fromEntries(Array.from(t).map(e=>[...e])):{...t}:{}}makeStatusError(t,e,n,s){return A.generate(t,e,n,s)}request(t,e=null){return new Oe(this.makeRequest(t,e))}async makeRequest(t,e){let n=await t;e==null&&(e=n.maxRetries??this.maxRetries),await this.prepareOptions(n);let{req:s,url:o,timeout:i}=this.buildRequest(n);if(await this.prepareRequest(s,{url:o,options:n}),Qt("request",o,n,s.headers),n.signal?.aborted)throw new w;let a=new AbortController,c=await this.fetchWithTimeout(o,s,i,a).catch(Re);if(c instanceof Error){if(n.signal?.aborted)throw new w;if(e)return this.retryRequest(n,e);throw c.name==="AbortError"?new K:new G({cause:c})}let f=rs(c.headers);if(!c.ok){if(e&&this.shouldRetry(c)){let y=`retrying, ${e} attempts remaining`;return Qt(`response (error; ${y})`,c.status,o,f),this.retryRequest(n,e,f)}let g=await c.text().catch(y=>Re(y).message),b=as(g),h=b?void 0:g;throw Qt(`response (error; ${e?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,f,h),this.makeStatusError(c.status,b,h,f)}return{response:c,options:n,controller:a}}requestAPIList(t,e){let n=this.makeRequest(e,null);return new yr(this,n,t)}buildURL(t,e){let n=ls(t)?new URL(t):new URL(this.baseURL+(this.baseURL.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return on(s)||(e={...s,...e}),typeof e=="object"&&e&&!Array.isArray(e)&&(n.search=this.stringifyQuery(e)),n.toString()}stringifyQuery(t){return Object.entries(t).filter(([e,n])=>typeof n<"u").map(([e,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(e)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(e)}=`;throw new p(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(t,e,n,s){let{signal:o,...i}=e||{};o&&o.addEventListener("abort",()=>s.abort());let a=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,t,{signal:s.signal,...i}).finally(()=>{clearTimeout(a)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(t){let e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,n){let s,o=n?.["retry-after-ms"];if(o){let a=parseFloat(o);Number.isNaN(a)||(s=a)}let i=n?.["retry-after"];if(i&&!s){let a=parseFloat(i);Number.isNaN(a)?s=Date.parse(i)-Date.now():s=a*1e3}if(!(s&&0<=s&&s<60*1e3)){let a=t.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(e,a)}return await br(s),this.makeRequest(t,e-1)}calculateDefaultRetryTimeoutMillis(t,e){let o=e-t,i=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return i*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${gt}`}},le=class{constructor(t,e,n,s){Ie.set(this,void 0),ts(this,Ie,t,"f"),this.options=s,this.response=e,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let t=this.nextPageInfo();if(!t)throw new p("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let e={...this.options};if("params"in t&&typeof e.query=="object")e.query={...e.query,...t.params};else if("url"in t){let n=[...Object.entries(e.query||{}),...t.url.searchParams.entries()];for(let[s,o]of n)t.url.searchParams.set(s,o);e.query=void 0,e.path=t.url.toString()}return await es(this,Ie,"f").requestAPIList(this.constructor,e)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(Ie=new WeakMap,Symbol.asyncIterator)](){for await(let t of this.iterPages())for(let e of t.getPaginatedItems())yield e}},yr=class extends Oe{constructor(t,e,n){super(e,async s=>new n(t,s.response,await sn(s),s.options))}async*[Symbol.asyncIterator](){let t=await this;for await(let e of t)yield e}},rs=r=>new Proxy(Object.fromEntries(r.entries()),{get(t,e){let n=e.toString();return t[n.toLowerCase()]||t[n]}}),ns={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},P=r=>typeof r=="object"&&r!==null&&!on(r)&&Object.keys(r).every(t=>an(ns,t)),ss=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":en(Deno.build.os),"X-Stainless-Arch":tn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":en(process.platform),"X-Stainless-Arch":tn(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let r=os();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":gt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function os(){if(typeof navigator>"u"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:t,pattern:e}of r){let n=e.exec(navigator.userAgent);if(n){let s=n[1]||0,o=n[2]||0,i=n[3]||0;return{browser:t,version:`${s}.${o}.${i}`}}}return null}var tn=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",en=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),rn,is=()=>rn??(rn=ss()),as=r=>{try{return JSON.parse(r)}catch{return}},cs=new RegExp("^(?:[a-z]+:)?//","i"),ls=r=>cs.test(r),br=r=>new Promise(t=>setTimeout(t,r)),gr=(r,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new p(`${r} must be an integer`);if(t<0)throw new p(`${r} must be a positive integer`);return t},Re=r=>r instanceof Error?r:new Error(r);var Te=r=>{if(typeof process<"u")return process.env?.[r]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(r)?.trim()};function on(r){if(!r)return!0;for(let t in r)return!1;return!0}function an(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function nn(r,t){for(let e in t){if(!an(t,e))continue;let n=e.toLowerCase();if(!n)continue;let s=t[e];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function Qt(r,...t){typeof process<"u"&&process?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${r}`,...t)}var us=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)}),cn=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function _r(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var et=class extends le{constructor(t,e,n,s){super(t,e,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},C=class extends le{constructor(t,e,n,s){super(t,e,n,s),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){let t=this.nextPageInfo();if(!t)return null;if("params"in t)return t.params;let e=Object.fromEntries(t.url.searchParams);return Object.keys(e).length?e:null}nextPageInfo(){let t=this.getPaginatedItems();if(!t.length)return null;let e=t[t.length-1]?.id;return e?{params:{after:e}}:null}};var u=class{constructor(t){this._client=t}};var bt=class extends u{create(t,e){return this._client.post("/chat/completions",{body:t,...e,stream:t.stream??!1})}};bt||(bt={});var rt=class extends u{constructor(){super(...arguments),this.completions=new bt(this._client)}};(function(r){r.Completions=bt})(rt||(rt={}));var _t=class extends u{create(t,e){return this._client.post("/audio/speech",{body:t,...e,__binaryResponse:!0})}};_t||(_t={});var wt=class extends u{create(t,e){return this._client.post("/audio/transcriptions",H({body:t,...e}))}};wt||(wt={});var xt=class extends u{create(t,e){return this._client.post("/audio/translations",H({body:t,...e}))}};xt||(xt={});var nt=class extends u{constructor(){super(...arguments),this.transcriptions=new wt(this._client),this.translations=new xt(this._client),this.speech=new _t(this._client)}};(function(r){r.Transcriptions=wt,r.Translations=xt,r.Speech=_t})(nt||(nt={}));var At=class extends u{create(t,e,n){return this._client.post(`/assistants/${t}/files`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}retrieve(t,e,n){return this._client.get(`/assistants/${t}/files/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(t,e={},n){return P(e)?this.list(t,{},e):this._client.getAPIList(`/assistants/${t}/files`,St,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}del(t,e,n){return this._client.delete(`/assistants/${t}/files/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}},St=class extends C{};(function(r){r.AssistantFilesPage=St})(At||(At={}));var Pt=class extends u{constructor(){super(...arguments),this.files=new At(this._client)}create(t,e){return this._client.post("/assistants",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v1",...e?.headers}})}retrieve(t,e){return this._client.get(`/assistants/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v1",...e?.headers}})}update(t,e,n){return this._client.post(`/assistants/${t}`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(t={},e){return P(t)?this.list({},t):this._client.getAPIList("/assistants",Ct,{query:t,...e,headers:{"OpenAI-Beta":"assistants=v1",...e?.headers}})}del(t,e){return this._client.delete(`/assistants/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v1",...e?.headers}})}},Ct=class extends C{};(function(r){r.AssistantsPage=Ct,r.Files=At,r.AssistantFilesPage=St})(Pt||(Pt={}));function wr(r){return typeof r.parse=="function"}var st=r=>r?.role==="assistant",xr=r=>r?.role==="function",Ar=r=>r?.role==="tool";var B=function(r,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!s:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,e):s?s.value=e:t.set(r,e),e},d=function(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)},F,Me,je,ue,fe,ke,he,z,pe,$e,Be,Yt,Sr,We,Pr,Cr,Er,vr,pn,Rr,hn=10,Zt=class{constructor(){F.add(this),this.controller=new AbortController,Me.set(this,void 0),je.set(this,()=>{}),ue.set(this,()=>{}),fe.set(this,void 0),ke.set(this,()=>{}),he.set(this,()=>{}),z.set(this,{}),this._chatCompletions=[],this.messages=[],pe.set(this,!1),$e.set(this,!1),Be.set(this,!1),Yt.set(this,!1),vr.set(this,t=>{if(B(this,$e,!0,"f"),t instanceof Error&&t.name==="AbortError"&&(t=new w),t instanceof w)return B(this,Be,!0,"f"),this._emit("abort",t);if(t instanceof p)return this._emit("error",t);if(t instanceof Error){let e=new p(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new p(String(t)))}),B(this,Me,new Promise((t,e)=>{B(this,je,t,"f"),B(this,ue,e,"f")}),"f"),B(this,fe,new Promise((t,e)=>{B(this,ke,t,"f"),B(this,he,e,"f")}),"f"),d(this,Me,"f").catch(()=>{}),d(this,fe,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},d(this,vr,"f"))},0)}_addChatCompletion(t){this._chatCompletions.push(t),this._emit("chatCompletion",t);let e=t.choices[0]?.message;return e&&this._addMessage(e),t}_addMessage(t,e=!0){if("content"in t||(t.content=null),this.messages.push(t),e){if(this._emit("message",t),(xr(t)||Ar(t))&&t.content)this._emit("functionCallResult",t.content);else if(st(t)&&t.function_call)this._emit("functionCall",t.function_call);else if(st(t)&&t.tool_calls)for(let n of t.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}_connected(){this.ended||(d(this,je,"f").call(this),this._emit("connect"))}get ended(){return d(this,pe,"f")}get errored(){return d(this,$e,"f")}get aborted(){return d(this,Be,"f")}abort(){this.controller.abort()}on(t,e){return(d(this,z,"f")[t]||(d(this,z,"f")[t]=[])).push({listener:e}),this}off(t,e){let n=d(this,z,"f")[t];if(!n)return this;let s=n.findIndex(o=>o.listener===e);return s>=0&&n.splice(s,1),this}once(t,e){return(d(this,z,"f")[t]||(d(this,z,"f")[t]=[])).push({listener:e,once:!0}),this}emitted(t){return new Promise((e,n)=>{B(this,Yt,!0,"f"),t!=="error"&&this.once("error",n),this.once(t,e)})}async done(){B(this,Yt,!0,"f"),await d(this,fe,"f")}async finalChatCompletion(){await this.done();let t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new p("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),d(this,F,"m",Sr).call(this)}async finalMessage(){return await this.done(),d(this,F,"m",We).call(this)}async finalFunctionCall(){return await this.done(),d(this,F,"m",Pr).call(this)}async finalFunctionCallResult(){return await this.done(),d(this,F,"m",Cr).call(this)}async totalUsage(){return await this.done(),d(this,F,"m",Er).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(t,...e){if(d(this,pe,"f"))return;t==="end"&&(B(this,pe,!0,"f"),d(this,ke,"f").call(this));let n=d(this,z,"f")[t];if(n&&(d(this,z,"f")[t]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...e))),t==="abort"){let s=e[0];!d(this,Yt,"f")&&!n?.length&&Promise.reject(s),d(this,ue,"f").call(this,s),d(this,he,"f").call(this,s),this._emit("end");return}if(t==="error"){let s=e[0];!d(this,Yt,"f")&&!n?.length&&Promise.reject(s),d(this,ue,"f").call(this,s),d(this,he,"f").call(this,s),this._emit("end")}}_emitFinal(){let t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);let e=d(this,F,"m",We).call(this);e&&this._emit("finalMessage",e);let n=d(this,F,"m",Sr).call(this);n&&this._emit("finalContent",n);let s=d(this,F,"m",Pr).call(this);s&&this._emit("finalFunctionCall",s);let o=d(this,F,"m",Cr).call(this);o!=null&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",d(this,F,"m",Er).call(this))}async _createChatCompletion(t,e,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),d(this,F,"m",pn).call(this,e);let o=await t.create({...e,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(o)}async _runChatCompletion(t,e,n){for(let s of e.messages)this._addMessage(s,!1);return await this._createChatCompletion(t,e,n)}async _runFunctions(t,e,n){let s="function",{function_call:o="auto",stream:i,...a}=e,c=typeof o!="string"&&o?.name,{maxChatCompletions:f=hn}=n||{},g={};for(let h of e.functions)g[h.name||h.function.name]=h;let b=e.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(let h of e.messages)this._addMessage(h,!1);for(let h=0;h<f;++h){let m=(await this._createChatCompletion(t,{...a,function_call:o,functions:b,messages:[...this.messages]},n)).choices[0]?.message;if(!m)throw new p("missing message in ChatCompletion response");if(!m.function_call)return;let{name:y,arguments:S}=m.function_call,E=g[y];if(E){if(c&&c!==y){let v=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,name:y,content:v});continue}}else{let v=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${b.map(Z=>JSON.stringify(Z.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:y,content:v});continue}let I;try{I=wr(E)?await E.parse(S):S}catch(v){this._addMessage({role:s,name:y,content:v instanceof Error?v.message:String(v)});continue}let N=await E.function(I,this),M=d(this,F,"m",Rr).call(this,N);if(this._addMessage({role:s,name:y,content:M}),c)return}}async _runTools(t,e,n){let s="tool",{tool_choice:o="auto",stream:i,...a}=e,c=typeof o!="string"&&o?.function?.name,{maxChatCompletions:f=hn}=n||{},g={};for(let h of e.tools)h.type==="function"&&(g[h.function.name||h.function.function.name]=h.function);let b="tools"in e?e.tools.map(h=>h.type==="function"?{type:"function",function:{name:h.function.name||h.function.function.name,parameters:h.function.parameters,description:h.function.description}}:h):void 0;for(let h of e.messages)this._addMessage(h,!1);for(let h=0;h<f;++h){let m=(await this._createChatCompletion(t,{...a,tool_choice:o,tools:b,messages:[...this.messages]},n)).choices[0]?.message;if(!m)throw new p("missing message in ChatCompletion response");if(!m.tool_calls)return;for(let y of m.tool_calls){if(y.type!=="function")continue;let S=y.id,{name:E,arguments:I}=y.function,N=g[E];if(N){if(c&&c!==E){let O=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:S,content:O});continue}}else{let O=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${b.map(tt=>JSON.stringify(tt.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:S,content:O});continue}let M;try{M=wr(N)?await N.parse(I):I}catch(O){let tt=O instanceof Error?O.message:String(O);this._addMessage({role:s,tool_call_id:S,content:tt});continue}let v=await N.function(M,this),Z=d(this,F,"m",Rr).call(this,v);if(this._addMessage({role:s,tool_call_id:S,content:Z}),c)return}}}};Me=new WeakMap,je=new WeakMap,ue=new WeakMap,fe=new WeakMap,ke=new WeakMap,he=new WeakMap,z=new WeakMap,pe=new WeakMap,$e=new WeakMap,Be=new WeakMap,Yt=new WeakMap,vr=new WeakMap,F=new WeakSet,Sr=function(){return d(this,F,"m",We).call(this).content??null},We=function(){let t=this.messages.length;for(;t-- >0;){let e=this.messages[t];if(st(e))return{...e,content:e.content??null}}throw new p("stream ended without producing a ChatCompletionMessage with role=assistant")},Pr=function(){for(let t=this.messages.length-1;t>=0;t--){let e=this.messages[t];if(st(e)&&e?.function_call)return e.function_call;if(st(e)&&e?.tool_calls?.length)return e.tool_calls.at(-1)?.function}},Cr=function(){for(let t=this.messages.length-1;t>=0;t--){let e=this.messages[t];if(xr(e)&&e.content!=null||Ar(e)&&e.content!=null&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(s=>s.type==="function"&&s.id===e.tool_call_id)))return e.content}},Er=function(){let t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:e}of this._chatCompletions)e&&(t.completion_tokens+=e.completion_tokens,t.prompt_tokens+=e.prompt_tokens,t.total_tokens+=e.total_tokens);return t},pn=function(t){if(t.n!=null&&t.n>1)throw new p("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Rr=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};var de=class r extends Zt{static runFunctions(t,e,n){let s=new r,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(t,e,o)),s}static runTools(t,e,n){let s=new r,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(t,e,o)),s}_addMessage(t){super._addMessage(t),st(t)&&t.content&&this._emit("content",t.content)}};var W=function(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)},Ir=function(r,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!s:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,e):s?s.value=e:t.set(r,e),e},X,ot,Or,Fr,De,dn,te=class r extends Zt{constructor(){super(...arguments),X.add(this),ot.set(this,void 0)}get currentChatCompletionSnapshot(){return W(this,ot,"f")}static fromReadableStream(t){let e=new r;return e._run(()=>e._fromReadableStream(t)),e}static createChatCompletion(t,e,n){let s=new r;return s._run(()=>s._runChatCompletion(t,{...e,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(t,e,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),W(this,X,"m",Or).call(this);let o=await t.create({...e,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let i of o)W(this,X,"m",Fr).call(this,i);if(o.controller.signal?.aborted)throw new w;return this._addChatCompletion(W(this,X,"m",De).call(this))}async _fromReadableStream(t,e){let n=e?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),W(this,X,"m",Or).call(this),this._connected();let s=q.fromReadableStream(t,this.controller),o;for await(let i of s)o&&o!==i.id&&this._addChatCompletion(W(this,X,"m",De).call(this)),W(this,X,"m",Fr).call(this,i),o=i.id;if(s.controller.signal?.aborted)throw new w;return this._addChatCompletion(W(this,X,"m",De).call(this))}[(ot=new WeakMap,X=new WeakSet,Or=function(){this.ended||Ir(this,ot,void 0,"f")},Fr=function(e){if(this.ended)return;let n=W(this,X,"m",dn).call(this,e);this._emit("chunk",e,n);let s=e.choices[0]?.delta?.content,o=n.choices[0]?.message;s!=null&&o?.role==="assistant"&&o?.content&&this._emit("content",s,o.content)},De=function(){if(this.ended)throw new p("stream has ended, this shouldn't happen");let e=W(this,ot,"f");if(!e)throw new p("request ended without sending any chunks");return Ir(this,ot,void 0,"f"),gs(e)},dn=function(e){var n,s,o;let i=W(this,ot,"f"),{choices:a,...c}=e;i?Object.assign(i,c):i=Ir(this,ot,{...c,choices:[]},"f");for(let{delta:f,finish_reason:g,index:b,logprobs:h=null,...T}of e.choices){let m=i.choices[b];if(m||(m=i.choices[b]={finish_reason:g,index:b,message:{},logprobs:h,...T}),h)if(!m.logprobs)m.logprobs=Object.assign({},h);else{let{content:M,...v}=h;Object.assign(m.logprobs,v),M&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...M))}if(g&&(m.finish_reason=g),Object.assign(m,T),!f)continue;let{content:y,function_call:S,role:E,tool_calls:I,...N}=f;if(Object.assign(m.message,N),y&&(m.message.content=(m.message.content||"")+y),E&&(m.message.role=E),S&&(m.message.function_call?(S.name&&(m.message.function_call.name=S.name),S.arguments&&((s=m.message.function_call).arguments??(s.arguments=""),m.message.function_call.arguments+=S.arguments)):m.message.function_call=S),I){m.message.tool_calls||(m.message.tool_calls=[]);for(let{index:M,id:v,type:Z,function:O,...tt}of I){let V=(o=m.message.tool_calls)[M]??(o[M]={});Object.assign(V,tt),v&&(V.id=v),Z&&(V.type=Z),O&&(V.function??(V.function={arguments:""})),O?.name&&(V.function.name=O.name),O?.arguments&&(V.function.arguments+=O.arguments)}}}return i},Symbol.asyncIterator)](){let t=[],e=[],n=!1;return this.on("chunk",s=>{let o=e.shift();o?o.resolve(s):t.push(s)}),this.on("end",()=>{n=!0;for(let s of e)s.resolve(void 0);e.length=0}),this.on("abort",s=>{n=!0;for(let o of e)o.reject(s);e.length=0}),this.on("error",s=>{n=!0;for(let o of e)o.reject(s);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,i)=>e.push({resolve:o,reject:i})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new q(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function gs(r){let{id:t,choices:e,created:n,model:s,system_fingerprint:o,...i}=r;return{...i,id:t,choices:e.map(({message:a,finish_reason:c,index:f,logprobs:g,...b})=>{if(!c)throw new p(`missing finish_reason for choice ${f}`);let{content:h=null,function_call:T,tool_calls:m,...y}=a,S=a.role;if(!S)throw new p(`missing role for choice ${f}`);if(T){let{arguments:E,name:I}=T;if(E==null)throw new p(`missing function_call.arguments for choice ${f}`);if(!I)throw new p(`missing function_call.name for choice ${f}`);return{...b,message:{content:h,function_call:{arguments:E,name:I},role:S},finish_reason:c,index:f,logprobs:g}}return m?{...b,index:f,finish_reason:c,logprobs:g,message:{...y,role:S,content:h,tool_calls:m.map((E,I)=>{let{function:N,type:M,id:v,...Z}=E,{arguments:O,name:tt,...V}=N||{};if(v==null)throw new p(`missing choices[${f}].tool_calls[${I}].id
${Le(r)}`);if(M==null)throw new p(`missing choices[${f}].tool_calls[${I}].type
${Le(r)}`);if(tt==null)throw new p(`missing choices[${f}].tool_calls[${I}].function.name
${Le(r)}`);if(O==null)throw new p(`missing choices[${f}].tool_calls[${I}].function.arguments
${Le(r)}`);return{...Z,id:v,type:M,function:{...V,name:tt,arguments:O}}})}}:{...b,message:{...y,content:h,role:S},finish_reason:c,index:f,logprobs:g}}),created:n,model:s,object:"chat.completion",...o?{system_fingerprint:o}:{}}}function Le(r){return JSON.stringify(r)}var me=class r extends te{static fromReadableStream(t){let e=new r;return e._run(()=>e._fromReadableStream(t)),e}static runFunctions(t,e,n){let s=new r,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(t,e,o)),s}static runTools(t,e,n){let s=new r,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(t,e,o)),s}};var ge=class extends u{runFunctions(t,e){return t.stream?me.runFunctions(this._client.chat.completions,t,e):de.runFunctions(this._client.chat.completions,t,e)}runTools(t,e){return t.stream?me.runTools(this._client.chat.completions,t,e):de.runTools(this._client.chat.completions,t,e)}stream(t,e){return te.createChatCompletion(this._client.chat.completions,t,e)}};var Et=class extends u{constructor(){super(...arguments),this.completions=new ge(this._client)}};(function(r){r.Completions=ge})(Et||(Et={}));var D=function(r,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!s:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,e):s?s.value=e:t.set(r,e),e},_=function(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)},Ue,Ne,ye,be,qe,_e,Q,we,He,Xe,ee,Tr,Je=class{constructor(){this.controller=new AbortController,Ue.set(this,void 0),Ne.set(this,()=>{}),ye.set(this,()=>{}),be.set(this,void 0),qe.set(this,()=>{}),_e.set(this,()=>{}),Q.set(this,{}),we.set(this,!1),He.set(this,!1),Xe.set(this,!1),ee.set(this,!1),Tr.set(this,t=>{if(D(this,He,!0,"f"),t instanceof Error&&t.name==="AbortError"&&(t=new w),t instanceof w)return D(this,Xe,!0,"f"),this._emit("abort",t);if(t instanceof p)return this._emit("error",t);if(t instanceof Error){let e=new p(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new p(String(t)))}),D(this,Ue,new Promise((t,e)=>{D(this,Ne,t,"f"),D(this,ye,e,"f")}),"f"),D(this,be,new Promise((t,e)=>{D(this,qe,t,"f"),D(this,_e,e,"f")}),"f"),_(this,Ue,"f").catch(()=>{}),_(this,be,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emit("end")},_(this,Tr,"f"))},0)}_addRun(t){return t}_connected(){this.ended||(_(this,Ne,"f").call(this),this._emit("connect"))}get ended(){return _(this,we,"f")}get errored(){return _(this,He,"f")}get aborted(){return _(this,Xe,"f")}abort(){this.controller.abort()}on(t,e){return(_(this,Q,"f")[t]||(_(this,Q,"f")[t]=[])).push({listener:e}),this}off(t,e){let n=_(this,Q,"f")[t];if(!n)return this;let s=n.findIndex(o=>o.listener===e);return s>=0&&n.splice(s,1),this}once(t,e){return(_(this,Q,"f")[t]||(_(this,Q,"f")[t]=[])).push({listener:e,once:!0}),this}emitted(t){return new Promise((e,n)=>{D(this,ee,!0,"f"),t!=="error"&&this.once("error",n),this.once(t,e)})}async done(){D(this,ee,!0,"f"),await _(this,be,"f")}_emit(t,...e){if(_(this,we,"f"))return;t==="end"&&(D(this,we,!0,"f"),_(this,qe,"f").call(this));let n=_(this,Q,"f")[t];if(n&&(_(this,Q,"f")[t]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...e))),t==="abort"){let s=e[0];!_(this,ee,"f")&&!n?.length&&Promise.reject(s),_(this,ye,"f").call(this,s),_(this,_e,"f").call(this,s),this._emit("end");return}if(t==="error"){let s=e[0];!_(this,ee,"f")&&!n?.length&&Promise.reject(s),_(this,ye,"f").call(this,s),_(this,_e,"f").call(this,s),this._emit("end")}}async _threadAssistantStream(t,e,n){return await this._createThreadAssistantStream(e,t,n)}async _runAssistantStream(t,e,n,s){return await this._createAssistantStream(e,t,n,s)}async _runToolAssistantStream(t,e,n,s,o){return await this._createToolAssistantStream(n,t,e,s,o)}async _createThreadAssistantStream(t,e,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let o=await t.createAndRun({...e,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createToolAssistantStream(t,e,n,s,o){let i=o?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a=await t.submitToolOutputs(e,n,{...s,stream:!1},{...o,signal:this.controller.signal});return this._connected(),this._addRun(a)}async _createAssistantStream(t,e,n,s){let o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let i=await t.create(e,{...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(i)}};Ue=new WeakMap,Ne=new WeakMap,ye=new WeakMap,be=new WeakMap,qe=new WeakMap,_e=new WeakMap,Q=new WeakMap,we=new WeakMap,He=new WeakMap,Xe=new WeakMap,ee=new WeakMap,Tr=new WeakMap;var l=function(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)},j=function(r,t,e,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!s:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,e):s?s.value=e:t.set(r,e),e},R,Mr,J,Ve,L,Rt,re,vt,Qe,k,Ge,Ke,Ae,ze,xe,mn,gn,jr,yn,bn,_n,wn,Y=class r extends Je{constructor(){super(...arguments),R.add(this),Mr.set(this,[]),J.set(this,{}),Ve.set(this,{}),L.set(this,void 0),Rt.set(this,void 0),re.set(this,void 0),vt.set(this,void 0),Qe.set(this,void 0),k.set(this,void 0),Ge.set(this,void 0),Ke.set(this,void 0),Ae.set(this,void 0)}[(Mr=new WeakMap,J=new WeakMap,Ve=new WeakMap,L=new WeakMap,Rt=new WeakMap,re=new WeakMap,vt=new WeakMap,Qe=new WeakMap,k=new WeakMap,Ge=new WeakMap,Ke=new WeakMap,Ae=new WeakMap,R=new WeakSet,Symbol.asyncIterator)](){let t=[],e=[],n=!1;return this.on("event",s=>{let o=e.shift();o?o.resolve(s):t.push(s)}),this.on("end",()=>{n=!0;for(let s of e)s.resolve(void 0);e.length=0}),this.on("abort",s=>{n=!0;for(let o of e)o.reject(s);e.length=0}),this.on("error",s=>{n=!0;for(let o of e)o.reject(s);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,i)=>e.push({resolve:o,reject:i})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){let e=new r;return e._run(()=>e._fromReadableStream(t)),e}async _fromReadableStream(t,e){let n=e?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=q.fromReadableStream(t,this.controller);for await(let o of s)l(this,R,"m",jr).call(this,o);if(s.controller.signal?.aborted)throw new w;return this._addRun(l(this,R,"m",xe).call(this))}toReadableStream(){return new q(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,e,n,s,o){let i=new r;return i._run(()=>i._runToolAssistantStream(t,e,n,s,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(t,e,n,s,o){let i=o?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},c=await t.submitToolOutputs(e,n,a,{...o,signal:this.controller.signal});this._connected();for await(let f of c)l(this,R,"m",ze).call(this,f);if(c.controller.signal?.aborted)throw new w;return this._addRun(l(this,R,"m",xe).call(this))}static createThreadAssistantStream(t,e,n){let s=new r;return s._run(()=>s._threadAssistantStream(t,e,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(t,e,n,s){let o=new r;return o._run(()=>o._runAssistantStream(t,e,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return l(this,Ge,"f")}currentRun(){return l(this,Ke,"f")}currentMessageSnapshot(){return l(this,L,"f")}currentRunStepSnapshot(){return l(this,Ae,"f")}async finalRunSteps(){return await this.done(),Object.values(l(this,J,"f"))}async finalMessages(){return await this.done(),Object.values(l(this,Ve,"f"))}async finalRun(){if(await this.done(),!l(this,Rt,"f"))throw Error("Final run was not received.");return l(this,Rt,"f")}async _createThreadAssistantStream(t,e,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let o={...e,stream:!0},i=await t.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(let a of i)l(this,R,"m",ze).call(this,a);if(i.controller.signal?.aborted)throw new w;return this._addRun(l(this,R,"m",xe).call(this))}async _createAssistantStream(t,e,n,s){let o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},a=await t.create(e,i,{...s,signal:this.controller.signal});this._connected();for await(let c of a)l(this,R,"m",ze).call(this,c);if(a.controller.signal?.aborted)throw new w;return this._addRun(l(this,R,"m",xe).call(this))}static accumulateDelta(t,e){for(let[n,s]of Object.entries(e)){if(!t.hasOwnProperty(n)){t[n]=s;continue}let o=t[n];if(o==null){t[n]=s;continue}if(n==="index"||n==="type"){t[n]=s;continue}if(typeof o=="string"&&typeof s=="string")o+=s;else if(typeof o=="number"&&typeof s=="number")o+=s;else if(_r(o)&&_r(s))o=this.accumulateDelta(o,s);else if(Array.isArray(o)&&Array.isArray(s)){if(o.every(i=>typeof i=="string"||typeof i=="number")){o.push(...s);continue}}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${o}`);t[n]=o}return t}};ze=function(t){if(!this.ended)switch(j(this,Ge,t,"f"),l(this,R,"m",jr).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":l(this,R,"m",wn).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":l(this,R,"m",gn).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":l(this,R,"m",mn).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},xe=function(){if(this.ended)throw new p("stream has ended, this shouldn't happen");if(!l(this,Rt,"f"))throw Error("Final run has not been received");return l(this,Rt,"f")},mn=function(t){let[e,n]=l(this,R,"m",bn).call(this,t,l(this,L,"f"));j(this,L,e,"f"),l(this,Ve,"f")[e.id]=e;for(let s of n){let o=e.content[s.index];o?.type=="text"&&this._emit("textCreated",o.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,e),t.data.delta.content)for(let s of t.data.delta.content){if(s.type=="text"&&s.text){let o=s.text,i=e.content[s.index];if(i&&i.type=="text")this._emit("textDelta",o,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=l(this,re,"f")){if(l(this,vt,"f"))switch(l(this,vt,"f").type){case"text":this._emit("textDone",l(this,vt,"f").text,l(this,L,"f"));break;case"image_file":this._emit("imageFileDone",l(this,vt,"f").image_file,l(this,L,"f"));break}j(this,re,s.index,"f")}j(this,vt,e.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(l(this,re,"f")!==void 0){let s=t.data.content[l(this,re,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,l(this,L,"f"));break;case"text":this._emit("textDone",s.text,l(this,L,"f"));break}}l(this,L,"f")&&this._emit("messageDone",t.data),j(this,L,void 0,"f")}},gn=function(t){let e=l(this,R,"m",yn).call(this,t);switch(j(this,Ae,e,"f"),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":let n=t.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&e.step_details.type=="tool_calls")for(let o of n.step_details.tool_calls)o.index==l(this,Qe,"f")?this._emit("toolCallDelta",o,e.step_details.tool_calls[o.index]):(l(this,k,"f")&&this._emit("toolCallDone",l(this,k,"f")),j(this,Qe,o.index,"f"),j(this,k,e.step_details.tool_calls[o.index],"f"),l(this,k,"f")&&this._emit("toolCallCreated",l(this,k,"f")));this._emit("runStepDelta",t.data.delta,e);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":j(this,Ae,void 0,"f"),t.data.step_details.type=="tool_calls"&&l(this,k,"f")&&(this._emit("toolCallDone",l(this,k,"f")),j(this,k,void 0,"f")),this._emit("runStepDone",t.data,e);break;case"thread.run.step.in_progress":break}},jr=function(t){l(this,Mr,"f").push(t),this._emit("event",t)},yn=function(t){switch(t.event){case"thread.run.step.created":return l(this,J,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let e=l(this,J,"f")[t.data.id];if(!e)throw Error("Received a RunStepDelta before creation of a snapshot");let n=t.data;if(n.delta){let s=Y.accumulateDelta(e,n.delta);l(this,J,"f")[t.data.id]=s}return l(this,J,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":l(this,J,"f")[t.data.id]=t.data;break}if(l(this,J,"f")[t.data.id])return l(this,J,"f")[t.data.id];throw new Error("No snapshot available")},bn=function(t,e){let n=[];switch(t.event){case"thread.message.created":return[t.data,n];case"thread.message.delta":if(!e)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=t.data;if(s.delta.content)for(let o of s.delta.content)if(o.index in e.content){let i=e.content[o.index];e.content[o.index]=l(this,R,"m",_n).call(this,o,i)}else e.content[o.index]=o,n.push(o);return[e,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(e)return[e,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},_n=function(t,e){return Y.accumulateDelta(e,t)},wn=function(t){switch(j(this,Ke,t.data,"f"),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":j(this,Rt,t.data,"f"),l(this,k,"f")&&(this._emit("toolCallDone",l(this,k,"f")),j(this,k,void 0,"f"));break;case"thread.run.cancelling":break}};var It=class extends u{retrieve(t,e,n,s){return this._client.get(`/threads/${t}/messages/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}list(t,e,n={},s){return P(n)?this.list(t,e,{},n):this._client.getAPIList(`/threads/${t}/messages/${e}/files`,Ot,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}},Ot=class extends C{};(function(r){r.MessageFilesPage=Ot})(It||(It={}));var Ft=class extends u{constructor(){super(...arguments),this.files=new It(this._client)}create(t,e,n){return this._client.post(`/threads/${t}/messages`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}retrieve(t,e,n){return this._client.get(`/threads/${t}/messages/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}update(t,e,n,s){return this._client.post(`/threads/${t}/messages/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}list(t,e={},n){return P(e)?this.list(t,{},e):this._client.getAPIList(`/threads/${t}/messages`,Tt,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}},Tt=class extends C{};(function(r){r.MessagesPage=Tt,r.Files=It,r.MessageFilesPage=Ot})(Ft||(Ft={}));var Mt=class extends u{retrieve(t,e,n,s){return this._client.get(`/threads/${t}/runs/${e}/steps/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}list(t,e,n={},s){return P(n)?this.list(t,e,{},n):this._client.getAPIList(`/threads/${t}/runs/${e}/steps`,jt,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}},jt=class extends C{};(function(r){r.RunStepsPage=jt})(Mt||(Mt={}));var kt=class extends u{constructor(){super(...arguments),this.steps=new Mt(this._client)}create(t,e,n){return this._client.post(`/threads/${t}/runs`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers},stream:e.stream??!1})}retrieve(t,e,n){return this._client.get(`/threads/${t}/runs/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}update(t,e,n,s){return this._client.post(`/threads/${t}/runs/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers}})}list(t,e={},n){return P(e)?this.list(t,{},e):this._client.getAPIList(`/threads/${t}/runs`,$t,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}cancel(t,e,n){return this._client.post(`/threads/${t}/runs/${e}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}createAndStream(t,e,n){return Y.createAssistantStream(t,this._client.beta.threads.runs,e,n)}submitToolOutputs(t,e,n,s){return this._client.post(`/threads/${t}/runs/${e}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s?.headers},stream:n.stream??!1})}submitToolOutputsStream(t,e,n,s){return Y.createToolAssistantStream(t,e,this._client.beta.threads.runs,n,s)}},$t=class extends C{};(function(r){r.RunsPage=$t,r.Steps=Mt,r.RunStepsPage=jt})(kt||(kt={}));var Bt=class extends u{constructor(){super(...arguments),this.runs=new kt(this._client),this.messages=new Ft(this._client)}create(t={},e){return P(t)?this.create({},t):this._client.post("/threads",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v1",...e?.headers}})}retrieve(t,e){return this._client.get(`/threads/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v1",...e?.headers}})}update(t,e,n){return this._client.post(`/threads/${t}`,{body:e,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}del(t,e){return this._client.delete(`/threads/${t}`,{...e,headers:{"OpenAI-Beta":"assistants=v1",...e?.headers}})}createAndRun(t,e){return this._client.post("/threads/runs",{body:t,...e,headers:{"OpenAI-Beta":"assistants=v1",...e?.headers},stream:t.stream??!1})}createAndRunStream(t,e){return Y.createThreadAssistantStream(t,this._client.beta.threads,e)}};(function(r){r.Runs=kt,r.RunsPage=$t,r.Messages=Ft,r.MessagesPage=Tt})(Bt||(Bt={}));var it=class extends u{constructor(){super(...arguments),this.chat=new Et(this._client),this.assistants=new Pt(this._client),this.threads=new Bt(this._client)}};(function(r){r.Chat=Et,r.Assistants=Pt,r.AssistantsPage=Ct,r.Threads=Bt})(it||(it={}));var at=class extends u{create(t,e){return this._client.post("/completions",{body:t,...e,stream:t.stream??!1})}};at||(at={});var ct=class extends u{create(t,e){return this._client.post("/embeddings",{body:t,...e})}};ct||(ct={});var lt=class extends u{create(t,e){return this._client.post("/files",H({body:t,...e}))}retrieve(t,e){return this._client.get(`/files/${t}`,e)}list(t={},e){return P(t)?this.list({},t):this._client.getAPIList("/files",ut,{query:t,...e})}del(t,e){return this._client.delete(`/files/${t}`,e)}content(t,e){return this._client.get(`/files/${t}/content`,{...e,__binaryResponse:!0})}retrieveContent(t,e){return this._client.get(`/files/${t}/content`,{...e,headers:{Accept:"application/json",...e?.headers}})}async waitForProcessing(t,{pollInterval:e=5e3,maxWait:n=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),o=Date.now(),i=await this.retrieve(t);for(;!i.status||!s.has(i.status);)if(await br(e),i=await this.retrieve(t),Date.now()-o>n)throw new K({message:`Giving up on waiting for file ${t} to finish processing after ${n} milliseconds.`});return i}},ut=class extends et{};(function(r){r.FileObjectsPage=ut})(lt||(lt={}));var Wt=class extends u{create(t,e){return this._client.post("/fine_tuning/jobs",{body:t,...e})}retrieve(t,e){return this._client.get(`/fine_tuning/jobs/${t}`,e)}list(t={},e){return P(t)?this.list({},t):this._client.getAPIList("/fine_tuning/jobs",Dt,{query:t,...e})}cancel(t,e){return this._client.post(`/fine_tuning/jobs/${t}/cancel`,e)}listEvents(t,e={},n){return P(e)?this.listEvents(t,{},e):this._client.getAPIList(`/fine_tuning/jobs/${t}/events`,Lt,{query:e,...n})}},Dt=class extends C{},Lt=class extends C{};(function(r){r.FineTuningJobsPage=Dt,r.FineTuningJobEventsPage=Lt})(Wt||(Wt={}));var ft=class extends u{constructor(){super(...arguments),this.jobs=new Wt(this._client)}};(function(r){r.Jobs=Wt,r.FineTuningJobsPage=Dt,r.FineTuningJobEventsPage=Lt})(ft||(ft={}));var ht=class extends u{createVariation(t,e){return this._client.post("/images/variations",H({body:t,...e}))}edit(t,e){return this._client.post("/images/edits",H({body:t,...e}))}generate(t,e){return this._client.post("/images/generations",{body:t,...e})}};ht||(ht={});var pt=class extends u{retrieve(t,e){return this._client.get(`/models/${t}`,e)}list(t){return this._client.getAPIList("/models",dt,t)}del(t,e){return this._client.delete(`/models/${t}`,e)}},dt=class extends et{};(function(r){r.ModelsPage=dt})(pt||(pt={}));var mt=class extends u{create(t,e){return this._client.post("/moderations",{body:t,...e})}};mt||(mt={});var En,x=class extends Fe{constructor({baseURL:t=Te("OPENAI_BASE_URL"),apiKey:e=Te("OPENAI_API_KEY"),organization:n=Te("OPENAI_ORG_ID")??null,...s}={}){if(e===void 0)throw new p("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let o={apiKey:e,organization:n,...s,baseURL:t||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&cn())throw new p(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new at(this),this.chat=new rt(this),this.embeddings=new ct(this),this.files=new lt(this),this.images=new ht(this),this.audio=new nt(this),this.moderations=new mt(this),this.models=new pt(this),this.fineTuning=new ft(this),this.beta=new it(this),this._options=o,this.apiKey=e,this.organization=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(t){return{...super.defaultHeaders(t),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(t){return{Authorization:`Bearer ${this.apiKey}`}}};En=x;x.OpenAI=En;x.OpenAIError=p;x.APIError=A;x.APIConnectionError=G;x.APIConnectionTimeoutError=K;x.APIUserAbortError=w;x.NotFoundError=Xt;x.ConflictError=Jt;x.RateLimitError=Gt;x.BadRequestError=Nt;x.AuthenticationError=qt;x.InternalServerError=Kt;x.PermissionDeniedError=Ht;x.UnprocessableEntityError=Vt;var{OpenAIError:Xi,APIError:Ji,APIConnectionError:Vi,APIConnectionTimeoutError:Gi,APIUserAbortError:Ki,NotFoundError:zi,ConflictError:Qi,RateLimitError:Yi,BadRequestError:Zi,AuthenticationError:ta,InternalServerError:ea,PermissionDeniedError:ra,UnprocessableEntityError:na}=ur;(function(r){r.toFile=dr,r.fileFromPath=Ee,r.Page=et,r.CursorPage=C,r.Completions=at,r.Chat=rt,r.Embeddings=ct,r.Files=lt,r.FileObjectsPage=ut,r.Images=ht,r.Audio=nt,r.Moderations=mt,r.Models=pt,r.ModelsPage=dt,r.FineTuning=ft,r.Beta=it})(x||(x={}));var kr=r=>new x(r);var $r=function(r,t){return $r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])},$r(r,t)};function ne(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");$r(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Se(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function se(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),s,o=[],i;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(a){i={error:a}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(i)throw i.error}}return o}function oe(r,t,e){if(e||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return r.concat(o||Array.prototype.slice.call(t))}function $(r){return typeof r=="function"}function Ye(r){var t=function(n){Error.call(n),n.stack=new Error().stack},e=r(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Ze=Ye(function(r){return function(e){r(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,s){return s+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Pe(r,t){if(r){var e=r.indexOf(t);0<=e&&r.splice(e,1)}}var ie=function(){function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var t,e,n,s,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=Se(i),c=a.next();!c.done;c=a.next()){var f=c.value;f.remove(this)}}catch(y){t={error:y}}finally{try{c&&!c.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else i.remove(this);var g=this.initialTeardown;if($(g))try{g()}catch(y){o=y instanceof Ze?y.errors:[y]}var b=this._finalizers;if(b){this._finalizers=null;try{for(var h=Se(b),T=h.next();!T.done;T=h.next()){var m=T.value;try{vn(m)}catch(y){o=o??[],y instanceof Ze?o=oe(oe([],se(o)),se(y.errors)):o.push(y)}}}catch(y){n={error:y}}finally{try{T&&!T.done&&(s=h.return)&&s.call(h)}finally{if(n)throw n.error}}}if(o)throw new Ze(o)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)vn(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Pe(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&Pe(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=function(){var t=new r;return t.closed=!0,t}(),r}();var Br=ie.EMPTY;function tr(r){return r instanceof ie||r&&"closed"in r&&$(r.remove)&&$(r.add)&&$(r.unsubscribe)}function vn(r){$(r)?r():r.unsubscribe()}var U={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var ae={setTimeout:function(r,t){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];var s=ae.delegate;return s?.setTimeout?s.setTimeout.apply(s,oe([r,t],se(e))):setTimeout.apply(void 0,oe([r,t],se(e)))},clearTimeout:function(r){var t=ae.delegate;return(t?.clearTimeout||clearTimeout)(r)},delegate:void 0};function Rn(r){ae.setTimeout(function(){var t=U.onUnhandledError;if(t)t(r);else throw r})}function Wr(){}var In=function(){return Dr("C",void 0,void 0)}();function On(r){return Dr("E",void 0,r)}function Fn(r){return Dr("N",r,void 0)}function Dr(r,t,e){return{kind:r,value:t,error:e}}var Ut=null;function ce(r){if(U.useDeprecatedSynchronousErrorHandling){var t=!Ut;if(t&&(Ut={errorThrown:!1,error:null}),r(),t){var e=Ut,n=e.errorThrown,s=e.error;if(Ut=null,n)throw s}}else r()}function Tn(r){U.useDeprecatedSynchronousErrorHandling&&Ut&&(Ut.errorThrown=!0,Ut.error=r)}var Nr=function(r){ne(t,r);function t(e){var n=r.call(this)||this;return n.isStopped=!1,e?(n.destination=e,tr(e)&&e.add(n)):n.destination=Es,n}return t.create=function(e,n,s){return new rr(e,n,s)},t.prototype.next=function(e){this.isStopped?Ur(Fn(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Ur(On(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Ur(In,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(ie);var Ss=Function.prototype.bind;function Lr(r,t){return Ss.call(r,t)}var Ps=function(){function r(t){this.partialObserver=t}return r.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(n){er(n)}},r.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(n){er(n)}else er(t)},r.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){er(e)}},r}(),rr=function(r){ne(t,r);function t(e,n,s){var o=r.call(this)||this,i;if($(e)||!e)i={next:e??void 0,error:n??void 0,complete:s??void 0};else{var a;o&&U.useDeprecatedNextContext?(a=Object.create(e),a.unsubscribe=function(){return o.unsubscribe()},i={next:e.next&&Lr(e.next,a),error:e.error&&Lr(e.error,a),complete:e.complete&&Lr(e.complete,a)}):i=e}return o.destination=new Ps(i),o}return t}(Nr);function er(r){U.useDeprecatedSynchronousErrorHandling?Tn(r):Rn(r)}function Cs(r){throw r}function Ur(r,t){var e=U.onStoppedNotification;e&&ae.setTimeout(function(){return e(r,t)})}var Es={closed:!0,next:Wr,error:Cs,complete:Wr};var Mn=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function jn(r){return r}function kn(r){return r.length===0?jn:r.length===1?r[0]:function(e){return r.reduce(function(n,s){return s(n)},e)}}var qr=function(){function r(t){t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,n){var s=this,o=Rs(t)?t:new rr(t,e,n);return ce(function(){var i=s,a=i.operator,c=i.source;o.add(a?a.call(o,c):c?s._subscribe(o):s._trySubscribe(o))}),o},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},r.prototype.forEach=function(t,e){var n=this;return e=$n(e),new e(function(s,o){var i=new rr({next:function(a){try{t(a)}catch(c){o(c),i.unsubscribe()}},error:o,complete:s});n.subscribe(i)})},r.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},r.prototype[Mn]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return kn(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=$n(t),new t(function(n,s){var o;e.subscribe(function(i){return o=i},function(i){return s(i)},function(){return n(o)})})},r.create=function(t){return new r(t)},r}();function $n(r){var t;return(t=r??U.Promise)!==null&&t!==void 0?t:Promise}function vs(r){return r&&$(r.next)&&$(r.error)&&$(r.complete)}function Rs(r){return r&&r instanceof Nr||vs(r)&&tr(r)}var Bn=Ye(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var nr=function(r){ne(t,r);function t(){var e=r.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var n=new Wn(this,this);return n.operator=e,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new Bn},t.prototype.next=function(e){var n=this;ce(function(){var s,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var i=Se(n.currentObservers),a=i.next();!a.done;a=i.next()){var c=a.value;c.next(e)}}catch(f){s={error:f}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(s)throw s.error}}}})},t.prototype.error=function(e){var n=this;ce(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var s=n.observers;s.length;)s.shift().error(e)}})},t.prototype.complete=function(){var e=this;ce(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var n=e.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var n=this,s=this,o=s.hasError,i=s.isStopped,a=s.observers;return o||i?Br:(this.currentObservers=null,a.push(e),new ie(function(){n.currentObservers=null,Pe(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var n=this,s=n.hasError,o=n.thrownError,i=n.isStopped;s?e.error(o):i&&e.complete()},t.prototype.asObservable=function(){var e=new qr;return e.source=this,e},t.create=function(e,n){return new Wn(e,n)},t}(qr);var Wn=function(r){ne(t,r);function t(e,n){var s=r.call(this)||this;return s.destination=e,s.source=n,s}return t.prototype.next=function(e){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.next)===null||s===void 0||s.call(n,e)},t.prototype.error=function(e){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.error)===null||s===void 0||s.call(n,e)},t.prototype.complete=function(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)},t.prototype._subscribe=function(e){var n,s;return(s=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&s!==void 0?s:Br},t}(nr);var Hr=(r,t)=>{let e=new nr;return r.chat.completions.create({model:"gpt-3.5-turbo",messages:[{role:"user",content:t}]}).then(s=>{let o=s.choices[0].message.content;e.next({type:"collected",payload:o||""}),e.next({type:"finished",payload:o||""}),e.complete()}).catch(s=>{console.error("An error occurred:",s),e.error(s)}),e},Dn=(r,t)=>{let e=Hr(r,t);return new Promise(n=>{e.subscribe(s=>{s.type==="finished"&&n(s.payload)})})};var Xr=class{constructor(t){this.config=t}predict(t){let e=kr(this.config.openai);return Hr(e,t)}qPredict(t){let e=kr(this.config.openai);return Dn(e,t)}};export{Xr as Ragged};
